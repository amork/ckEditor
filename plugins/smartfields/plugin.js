(function(){CKEDITOR.plugins.add("smartfields",{lang:"en,ru",icons:"placeholder",hidpi:!0,onLoad:function(){CKEDITOR.addCss(".cke_placeholder{background-color:#ff0}")},init:function(a){a.widgets.add("smartfields",{pathName:a.lang.placeholder.pathName,template:'\x3cspan class\x3d"cke_placeholder"\x3e[[]]\x3c/span\x3e',downcast:function(){return new CKEDITOR.htmlParser.text("[["+this.data.name+"]]")},init:function(){this.setData("name",this.element.getText().slice(2,-2))},data:function(){this.element.setText("[["+
this.data.name+"]]")},getLabel:function(){return this.editor.lang.widget.label.replace(/%1/,this.data.name+" "+this.pathName)}});a.ui.addRichCombo("smartfields",{label:"Smart field",title:"Add smart field",toolbar:"basicstyles,0",init:function(){var b=this;(a.config.smartFields||[]).forEach(function(a){b.add(a.id,a.name)})},onClick:function(b){var d=a.getSelection().getRanges()[0].extractContents();b=CKEDITOR.dom.element.createFromHtml('\x3cspan class\x3d"cke_placeholder" \x3e[[smart_field_'+b+"]]\x3c/span\x3e",
a.document);d.appendTo(b);a.insertElement(b);a.widgets.initOn(b,"placeholder")}})},afterInit:function(a){var b=/\[\[([^\[\]])+\]\]/g;a.dataProcessor.dataFilter.addRules({text:function(d,e){var f=e.parent&&CKEDITOR.dtd[e.parent.name];if(!f||f.span)return d.replace(b,function(b){var c=null,c=new CKEDITOR.htmlParser.element("span",{"class":"cke_placeholder"});c.add(new CKEDITOR.htmlParser.text(b));c=a.widgets.wrapElement(c,"placeholder");return c.getOuterHtml()})}})}})})();